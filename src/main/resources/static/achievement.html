<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Achievements</title>
    <link rel="stylesheet" href="css/main-page.css">
    <link rel="stylesheet" href="css/achievement.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <div class="logo-container">
                <h1>GoLanguage</h1>
            </div>
            <nav class="nav-menu">
                <ul>
                    <li>
                        <a href="#" id="learnLink"><i class="fas fa-book"></i> <span>Learn</span></a>
                    </li>
                    <li class="active">
                        <a href="#"><i class="fas fa-trophy"></i> <span>Achievements</span></a>
                    </li>
                    <li>
                        <a href="profile.html"><i class="fas fa-user"></i> <span>Profile</span></a>
                    </li>
                    <li>
                        <a href="about-us.html"><i class="fas fa-info-circle"></i> <span>About Us</span></a>
                    </li>
                    <li>
                        <a href="#"><i class="fas fa-sign-out-alt"></i> <span>Log Out</span></a>
                    </li>
                </ul>
            </nav>
        </div>


        <div class="achievement-wrapper">
            <div class="achievement-section">
                <h2>
                    <img src="images/malaysia_flag.webp" alt="Malaysia Flag" class="flag-icon">
                    Achievements - Malay
                </h2>
                <div id="malay-achievements" class="achievement-list"></div>
            </div>

            <div class="achievement-section">
                <h2>
                    <img src="images/Flag_of_the_People's_Republic_of_China.webp" alt="China Flag" class="flag-icon">
                    Achievements - Chinese
                </h2>
                <div id="chinese-achievements" class="achievement-list"></div>
            </div>
        </div>
    </div>
    <script>
        const selectedLanguage = localStorage.getItem("selectedLanguage");
        const userId = localStorage.getItem("userId");

        if (!userId) {
            alert("User not logged in.");

            const selectedLanguage = localStorage.getItem("selectedLanguage");
            const malayContainer = document.getElementById("malay-achievements");
            const chineseContainer = document.getElementById("chinese-achievements");

            // Create a placeholder block
            const block = document.createElement("div");
            block.className = "achievement-item";
            block.innerHTML = `
                <div class="achievement-content">
                    <div class="achievement-text">
                        <div class="achievement-name">Null</div>
                        <div class="achievement-date">--</div>
                    </div>
                    <div class="achievement-status">Not Logged In</div>
                </div>
            `;

            if (selectedLanguage === "Malay") {
                chineseContainer.parentElement.style.display = "none";
                malayContainer.appendChild(block);
                malayContainer.parentElement.style.display = "block";
            } else if (selectedLanguage === "Chinese") {
                malayContainer.parentElement.style.display = "none";
                chineseContainer.appendChild(block);
                chineseContainer.parentElement.style.display = "block";
            }
        } else {
            fetch(`http://localhost:8080/api/Achievement/filterBy/${userId}`)
                .then(response => response.json())
                .then(userAchievements => {
                    const malayContainer = document.getElementById("malay-achievements");
                    const chineseContainer = document.getElementById("chinese-achievements");

                    // Hide both containers initially
                    malayContainer.parentElement.style.display = "none";
                    chineseContainer.parentElement.style.display = "none";

                    userAchievements.forEach(item => {
                        const block = document.createElement("div");
                        block.className = "achievement-item";
                        block.innerHTML = `
                        <div class="achievement-content">
                            <div class="achievement-text">
                                <div class="achievement-name">${item.name}</div>
                                <div class="achievement-date">${new Date(item.completedTime).toLocaleString()}</div>
                            </div>
                            <div class="achievement-status">${item.status}</div>
                        </div>
                    `;

                        if (item.name.toLowerCase().startsWith("malay") && selectedLanguage === "Malay") {
                            malayContainer.appendChild(block);
                            malayContainer.parentElement.style.display = "block"; // show the section
                        } else if (item.name.toLowerCase().startsWith("chinese") && selectedLanguage === "Chinese") {
                            chineseContainer.appendChild(block);
                            chineseContainer.parentElement.style.display = "block"; // show the section
                        }
                    });
                })
                .catch(error => {
                    console.error("Failed to load achievements:", error);
                });
        }


        // Back to Language Selected Page
        document.getElementById('learnLink').addEventListener('click', function (e) {
            e.preventDefault(); // prevent default link behavior

            const language = localStorage.getItem('selectedLanguage');

            if (language === 'Chinese') {
                window.location.href = 'chinese.html';
            } else if (language === 'Malay') {
                window.location.href = 'bahasa-melayu.html';
            }
        });
        // Clear localStorage("userId)
        document.getElementById('logoutBtn').addEventListener('click', function (event) {
            event.preventDefault();
            localStorage.removeItem('userId'); // Clear userId
            window.location.href = 'index.html';
        });
    </script>

</body>
</html>
